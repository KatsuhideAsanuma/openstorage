# openstorageプロジェクト

## 背景と経緯の説明

- このプロジェクトは、画像、テキスト、映像、音楽の4種類のデータを保存・管理する多目的のデータストレージを作成することを目的としています。
- 使用する技術スタックはMySQL、Redis、Play Frameworkです。
- 開発はvscodeベースのエディタでローカルで行います。
- APIキーでの認証、Postmanでのテスト、Swaggerでのドキュメント管理が決定しています。

## 今まで作業済みの項目

- APIエンドポイントの設計（api_concept.md）
- データモデルとデータベース設計（evolution_migration_script_model.sql）
- ファイル構成案（proposed_file_structure.md）

## タスクリスト

### **設計**

    - 設計案を関連するファイルにまとめる
    - 機能詳細の設計

### **実装**

    - Play FrameworkでAPIとストリーミング機能を実装
    - MySQLとRedisのデータベース操作を実装

### **SDK開発**

    - ユーザーがAPIに簡単にアクセスできるようなSDKを設計
    - SDKの実装

### **テストとデプロイ**

    - 単体テスト、結合テストを行う
    - 本番環境にデプロイ

## 順序関連情報

- APIとストリーミング設計が完了したら、実装に移る。
- 実装が完了したら、SDKの開発に取り掛かる。
- 最後にテストとデプロイを行います。

## 説明

- APIとストリーミング設計では、どのようなAPIエンドポイントが必要か、どのようにデータをストリーミングするかを決定します。
- 実装では、設計したAPIとストリーミング機能をコードに落とし込みます。
- SDK開発では、ユーザーがAPIに簡単にアクセスできるようなライブラリを作成します。

## すべきこと

- 各タスクに取り組む前に、必要なライブラリやツールが全て揃っているか確認する。
- APIの認証方法やテストツールについても、事前に設定を完了させる。

## 詳細に設計すべき項目

1. **データベース設計**:
    - **説明**: 使用するテーブル、その関係、カラムの詳細、インデックス、外部キー制約などを明確に定義する必要がありますわ。
    
2. **APIエンドポイントの詳細設計**:
    - **説明**: 各エンドポイントでのリクエスト・レスポンスのフォーマット、エラーハンドリング、HTTPステータスコードの定義などを詳細に設計しますわ。

3. **認証・認可の仕組み**:
    - **説明**: ユーザーの認証方法、APIのアクセス権限、セッション管理、トークンの使用方法などの設計
    - 認証方法: OAuth2.0を使用
    - APIのアクセス権限:
        管理者ユーザ: 全ての権限を持つ
        投稿ユーザ: 自分の投稿物についてのみ権限を持つ
        閲覧ユーザ: APIキーで閲覧するのみ
    - セッション管理: 30分の有効期限

4. **エラーハンドリングとログ管理**:
    - **説明**: システムやAPIでのエラーのハンドリング方法、ログの収集・保存・解析の方法を定義しますわ。

    - エラーハンドリング
    - カスタムエラークラスの導入:
    現在、エラーメッセージは文字列の形式で返されていますが、カスタムエラークラスを使用して、エラータイプやコードも返すようにすると、エラーの種類を簡単に特定できますわ。
    InvalidUserTypeError: 提供されたユーザータイプが無効の場合にスローされるエラー
    EmailAlreadyRegisteredError: メールが既に登録されている場合にスローされるエラー
    UserNotFoundError: システム内にユーザーが見つからない場合にスローされるエラー

    - 中央エラーハンドリング:

    APIエンドポイントのエラーハンドリングは一元化されているか確認する必要があります。これにより、冗長なエラーハンドリングコードを避け、メンテナンス性を向上させることができますわ。すべてのAPIエラーは、エラーレスポンスの一貫性を保証し、冗長なエラーハンドリングコードを避けるために中央で処理されます。

    - APIエラーレスポンスの標準化:

    現在のエラーレスポンスには、エラーメッセージが含まれていますが、HTTPステータスコードやエラーコードも含めることを検討してください。
    各エラーレスポンスには次のものが含まれます：
    statusCode: HTTPステータスコード
    errorCode: カスタムエラーコード（例：InvalidUserTypeError）
    message: 説明的なエラーメッセージ
    構造化されたロギング:

    - ログ作成
    - ログの構造化:
    エラー発生時のログは、キー/バリューのペアで構造化されていますか？ エラーの原因を特定するための関連情報（例: ユーザーID、エンドポイント、タイムスタンプ）もログに含めるようにすると良いですわ。
    - エラーログの詳細化:
    エラーが発生した場合、具体的な原因やスタックトレースもログに記録するようにしてください。
    ログはキー/バリューのペアで構造化されており、ログ分析が容易です。エラーが発生した場合、ログには次のものも含まれます：
    endpoint: エラーが発生したAPIエンドポイント
    timestamp: エラーが発生した時刻
    details: エラーに関する追加の詳細（例：スタックトレース）

5. **フロントエンドとの連携**:
    - **説明**: フロントエンドとのデータの受け渡し方法、同期・非同期の処理、UI/UXの設計などを詳細に検討する必要がありますわ。

6. **パフォーマンスとスケーラビリティの設計**:
    - **説明**: データベースのクエリの最適化、キャッシング、ロードバランサの使用など、システムのパフォーマンスとスケーラビリティを考慮した設計を行います。

7. **セキュリティの設計**:
    - **説明**: データの暗号化、APIのセキュリティ、侵入検知システムの導入など、システム全体のセキュリティを確保するための設計が必要ですわ。

8. **バックアップとリカバリの設計**:
    - **説明**: データのバックアップ方法、リカバリのシナリオ、災害復旧の計画などを詳細に検討しますわ。

9. **テスト戦略**:
    - **説明**: 単体テスト、統合テスト、パフォーマンステストなどのテストの種類と、それぞれのテストで確認する項目を定義しますわ。

10. **デプロイメントと継続的インテグレーション**:
    - **説明**: プロジェクトのデプロイメント方法、継続的インテグレーションのツールとフローを設計しますわ。

